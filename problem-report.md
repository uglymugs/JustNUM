# Problem Report

We hope that future developers will find it easy to get up to speed with our app, as we have followed the guidelines for good practice set out by Dan Abramov in his Redux videos and exemplified by the minimal repo [here](https://github.com/gaearon/todos).

There are nonetheless various corners and complexities that may not be immediately obvious. To aid in understanding these, we are building a record of the technical problems that we encountered on this project and the solutions that we found.

At the moment the report is very much *in progress...*

##### Deployd Boolean Fields

###### Problem

Submitting a form to the database was returning a generic error even though form data was good.

###### Solution

Deployd debug logs revealed validation on the backend was failing on certain boolean fields. The fields were set to ´isRequired´ and Deployd was failing to distinguish between values of ´false´ and ´null´ or ´undefined´. The workaround was to remove ´isRequired´ for these fields--if they are missing Deployd sets them to false anyway.

##### Deployd Dashboard Key

###### Problem

This is easy to get from the local command line but what about when the app is hosted remotely?

###### Solution

Run ´dpd keygen && dpd showkey && npm start´ from the Procfile and get the key from Heroku log.

##### Hash history querystring

###### Solution

´hashHistory´ from React-router puts a querystring starting ´_k=´ after every url. This is ugly and causes issues with navigation using the address bar; for example, hitting refresh will incorporate the querystring into the ´path´ recognised by React-router.

It is possible to manually create a hash history object without a query string and pass it to React-router. This only works if you use the same version of ´history´ as React-router:

´´´javascript
import { Router, useRouterHistory } from 'react-router';
import { createHashHistory } from 'history';

const appHistory = useRouterHistory(createHashHistory)({ queryKey: false });

<Router history={appHistory}>
´´´

Be aware that the querystring is used by ´hashHistory´ to access any state you set for your locations like this:

´´´javascript
router.push('/home', { some: 'state' })
´´´

We do not use location state, so removing the querystring is fine.

This may not be an issue with React-router v.3 (still alpha). See [here](https://github.com/ReactTraining/react-router/issues/1967).

##### Tasks form list

Tasks would would appear to be randomly missing from the list of editable tasks beneath the case form. This was noticeable when switching between 'all' and 'pending' or 'to do' on the filter. When multiple components are generated by a loop as an array, React uses a ´key´ prop to keep track of which components inside the array get added, removed or changed. We were setting this prop by the index of the element in the mapped array, a practice that React docs suggest is [acceptable, if non-optimal](https://facebook.github.io/react/docs/lists-and-keys.html), since without a 1:1 correspondence between data and key React cannot optimise the diff. 

´´´javascript
{tasks.map((task, idx) =>
      <ConnectedEditTaskForm key={idx} task={task} />)}
´´´

In fact, setting the key from the index can break the rerender entirely. Here's why (I think): if we apply a filter that selects items 3 and 4 from the list, their keys will be changed to 0 and 1. React will not rerender the components that already have those keys -- i.e. items 1 and 2 on the list. But we have filtered out their data on the props so we will get empty components...

The solution was to use the unique id from the database:

´´´javascript
{tasks.map((task) =>
      <ConnectedEditTaskForm key={task.id} task={task} />)}
´´´
